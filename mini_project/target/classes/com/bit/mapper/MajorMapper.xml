<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-Mapper.dtd" >

<mapper namespace="com.bit.mapper.MajorMapper">
	
	<!-- 강좌 목록 전체 출력 -->
	<select id="majorList" resultType="com.bit.domain.MajorVO">
		SELECT *
		FROM Major
	</select>
	
	<!-- 강좌 수 -->
	<select id="majorTotal" resultType="int">
		SELECT COUNT(*) 
		FROM Major
	</select>
	
	<!-- 희망강좌선택 -->
	<insert id="selectMyMajor" parameterType="com.bit.domain.MyMajorVO">
		INSERT INTO MyMajor(StudentID, MajorCode, MajorName, MajorTime, MajorLocation, TargetGrade, GradePoint, MajorLimit, Professor, MajorDivision)
		VALUES (#{StudentID}, #{MajorCode}, #{MajorName}, #{MajorTime}, #{MajorLocation}, #{TargetGrade}, #{GradePoint}, #{MajorLimit}, #{Professor}, #{MajorDivision}) 
	</insert>
	
	<!-- 내가 선택한 강좌 목록 출력 -->
	<select id="myMajorList" resultType="com.bit.domain.MyMajorVO">
		SELECT *
		FROM MyMajor
		WHERE StudentID = #{StudentID}
	</select>
	
	<!-- 선택한 강좌 목록에서 삭제 -->
	<delete id="deleteMyMajor">
		DELETE FROM MyMajor
		WHERE StudentID = #{StudentID} AND MajorCode = #{MajorCode}
	</delete>
	
	<!-- 최종수강신청 -->
	<insert id="finalDecision" parameterType="com.bit.domain.FinalVO">
		INSERT INTO Final(StudentID, CheckOK)
		VALUES (#{StudentID}, #{CheckOK})
	</insert>
	
	<!-- 수강신청 여부 확인 -->
	<select id="checkOK" resultType="com.bit.domain.FinalVO">
		SELECT *
		FROM Final
		WHERE StudentID = #{StudentID} OR StudentID = #{MemberID}
	</select>
	
	<!-- 강좌 리스트 요청 -->
   <select id="getMajorNameList" resultType="String">
   
      	select MajorName from Major where MajorCode like concat ('%', #{keyword}, '%')
      
   		<!-- 강좌코드을 검색하고 강좌이름을 찾는다-->
   </select>
   
   <!-- 다중 검색 조건 -->
   <sql id="criteria">
      <trim prefix="where (" suffix=")" prefixOverrides="AND"> <!--  prefixOverrides를 사용하는이유 WHERE 첫번째 줄에는 and가 없어야한다.--> 
         <foreach item="type" collection="typeArr">
            <trim prefix="AND">
               <choose>
                     <when test="type == 'M'.toString()">
                           <trim prefixOverrides="or">
                              <foreach collection="MajorArr" item="MajorCode">
                                 <trim prefix="or">
                                    'MajorCode=#{MajorCode}'
                                 </trim>
                              </foreach>
                           </trim>   
                     </when>
                     <when test="type == 'D'.toString()">
                        MajorDivision like concat ('%', #{keyword}, '%')
                     </when>
                     <when test="type == 'T'.toString()">
                        MajorTime like concat ('%', #{keyword}, '%')
                     </when>
                     <when test="type == 'L'.toString()">
                        MajorLocation like concat ('%', #{keyword}, '%')
                     </when>
                     <when test="type == 'G'.toString()">
                        MajorGrade like concat ('%', #{keyword}, '%')
                     </when>
               </choose>
            </trim>
         </foreach>
      </trim> 
   </sql>
   
   <!-- 강좌 검색 -->
   <select id="getMajorList" resultType="com.bit.domain.MajorVO">
      
      select * 
      
      from major
      
      <include refid="criteria"></include>      
      
      order by majorcode desc
      
      limit #{skip}, #{amount}
   
   </select>
   
   <!-- 강좌 총 숫자 -->
   <select id="MajorGetTotal" resultType="int">
      select count(*) from major
      
      <include refid="criteria"></include>      
      
   </select>
	
</mapper>